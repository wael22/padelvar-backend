# =========================================================================
# CONFIGURATION PADELVAR BACKEND V2.0
# =========================================================================
# Copiez ce fichier en .env et configurez selon votre environnement

# =========================================================================
# ENVIRONNEMENT
# =========================================================================
FLASK_ENV=development
FLASK_DEBUG=true
APP_NAME=PadelVar
APP_VERSION=2.0.0

# =========================================================================
# BASE DE DONNÉES
# =========================================================================
# PostgreSQL (REQUIS en production, SQLite auto en développement)
DB_HOST=postgresql
DB_PORT=5432
DB_NAME=padelvar_prod
DB_USER=padelvar_user
DB_PASSWORD=CHANGEME_STRONG_DATABASE_PASSWORD_123!

# URL complète (générée automatiquement si non définie)
# DATABASE_URL=postgresql://padelvar_user:password@postgresql:5432/padelvar_prod

# =========================================================================
# REDIS (REQUIS pour Celery et rate limiting)
# =========================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGEME_REDIS_PASSWORD_456!
REDIS_DB=0

# URL complète (générée automatiquement si non définie)  
# REDIS_URL=redis://:password@redis:6379/0

# =========================================================================
# SÉCURITÉ (CHANGEZ TOUS CES SECRETS)
# =========================================================================
SECRET_KEY=CHANGEME_SUPER_SECRET_KEY_789_MINIMUM_32_CHARS!
JWT_SECRET_KEY=CHANGEME_JWT_SECRET_012_DIFFERENT_FROM_SECRET_KEY!
JWT_ACCESS_TOKEN_EXPIRES=3600  # 1 heure en secondes
JWT_REFRESH_TOKEN_EXPIRES=2592000  # 30 jours en secondes

# =========================================================================
# STRIPE PAIEMENTS (REQUIS pour fonctionnalité paiements)
# =========================================================================
# Clés de test (commencent par pk_test_ et sk_test_)
STRIPE_PUBLISHABLE_KEY=pk_test_51ABC123DEF456GHI789JKL012MNO345PQR678STU901VWX234YZ567
STRIPE_SECRET_KEY=sk_test_51ABC123DEF456GHI789JKL012MNO345PQR678STU901VWX234YZ567
STRIPE_WEBHOOK_SECRET=whsec_ABC123DEF456GHI789JKL012MNO345PQR

# Clés de production (décommentez et configurez pour production)
# STRIPE_PUBLISHABLE_KEY=pk_live_...
# STRIPE_SECRET_KEY=sk_live_...
# STRIPE_WEBHOOK_SECRET=whsec_...

# =========================================================================
# BUNNY CDN (REQUIS pour stockage vidéo)  
# =========================================================================
BUNNY_API_KEY=your-bunny-api-key-here-ABC123-DEF456
BUNNY_STORAGE_ZONE=your-storage-zone-name
BUNNY_PULL_ZONE=your-pull-zone-name  
BUNNY_BASE_URL=https://your-zone.b-cdn.net
BUNNY_STORAGE_PASSWORD=your-storage-password

# =========================================================================
# EMAIL (OPTIONNEL - pour notifications email)
# =========================================================================
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-gmail-app-password
MAIL_USE_TLS=true
MAIL_DEFAULT_SENDER=noreply@padelvar.com

# =========================================================================
# CELERY (TRAITEMENT ASYNCHRONE)
# =========================================================================
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/2

# Configuration des workers
CELERY_WORKER_CONCURRENCY=2
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_SOFT_TIME_LIMIT=300
CELERY_TASK_TIME_LIMIT=600

# =========================================================================
# MONITORING ET MÉTRIQUES
# =========================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
GRAFANA_ENABLED=true
GRAFANA_PORT=3000
GRAFANA_ADMIN_PASSWORD=CHANGEME_GRAFANA_PASSWORD_456!

# =========================================================================
# RATE LIMITING
# =========================================================================
RATELIMIT_ENABLED=true
RATELIMIT_STORAGE_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/3
RATELIMIT_DEFAULT=100/hour
RATELIMIT_AUTH=10/minute
RATELIMIT_UPLOAD=5/minute

# =========================================================================
# LOGGING
# =========================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=logs/padelvar.log
LOG_MAX_BYTES=10485760  # 10MB
LOG_BACKUP_COUNT=5

# =========================================================================
# FFMPEG ET TRAITEMENT VIDÉO
# =========================================================================
FFMPEG_PATH=/usr/bin/ffmpeg
FFMPEG_THREADS=2
FFMPEG_QUALITY=medium
VIDEO_MAX_DURATION=7200  # 2 heures en secondes
VIDEO_MAX_SIZE=2147483648  # 2GB en bytes

# =========================================================================
# DOMAINE ET SSL (PRODUCTION)
# =========================================================================
DOMAIN_NAME=padelvar.com
SSL_EMAIL=admin@padelvar.com
ALLOWED_HOSTS=padelvar.com,www.padelvar.com,localhost

# =========================================================================
# DOCKER ET DÉPLOIEMENT
# =========================================================================
# Configuration Docker Compose
COMPOSE_PROJECT_NAME=padelvar
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# Restart policy
RESTART_POLICY=unless-stopped

# Ports externes (modifiez si conflits)
APP_PORT=5000
POSTGRES_PORT=5432
REDIS_PORT=6379
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# =========================================================================
# DÉVELOPPEMENT (uniquement pour env development)
# =========================================================================
# Désactiver en production
FLASK_DEBUG_TB_ENABLED=true
FLASK_DEBUG_TB_INTERCEPT_REDIRECTS=false

# Base de données de test
TEST_DATABASE_URL=sqlite:///:memory:

# =========================================================================
# FONCTIONNALITÉS OPTIONNELLES
# =========================================================================
# Notifications WebSocket (à venir v2.1)
WEBSOCKET_ENABLED=false
WEBSOCKET_PORT=5001

# Google OAuth (optionnel)
GOOGLE_OAUTH_CLIENT_ID=your-google-oauth-client-id
GOOGLE_OAUTH_CLIENT_SECRET=your-google-oauth-client-secret

# Sentry pour monitoring des erreurs (optionnel)
SENTRY_DSN=https://your-sentry-dsn-here

# =========================================================================
# VARIABLES CALCULÉES AUTOMATIQUEMENT
# =========================================================================
# Ces variables sont générées par l'application, ne les modifiez pas
# DATABASE_URL (calculé depuis DB_*)
# REDIS_URL (calculé depuis REDIS_*)
# CELERY_BROKER_URL (calculé depuis REDIS_*)

# =========================================================================
# NOTES IMPORTANTES
# =========================================================================
# 1. CHANGEZ TOUS LES MOTS DE PASSE PAR DÉFAUT !
# 2. En production, utilisez des secrets forts (32+ caractères)
# 3. Ne jamais commiter ce fichier .env dans Git
# 4. Utilisez des clés Stripe de production uniquement en production
# 5. Configurez les variables d'environnement dans votre hébergeur

# =========================================================================
# GÉNÉRATION DE MOTS DE PASSE FORTS
# =========================================================================
# Utilisez ces commandes pour générer des mots de passe sécurisés :
# openssl rand -base64 32  # Pour SECRET_KEY (43 chars)
# openssl rand -base64 24  # Pour mots de passe (32 chars)
# python -c "import secrets; print(secrets.token_urlsafe(32))"

# =========================================================================
# VALIDATION CONFIGURATION
# =========================================================================
# Après configuration, validez avec :
# make validate-config
# python scripts/validate_config.py